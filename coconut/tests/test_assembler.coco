import numpy as np
import pandas as pd

from pipeline import fit_transform, pipeline
from features import assembler, one_hot_encoder

def test_one_hot_encoder():
    df = pd.DataFrame({'some_id': [1, 2, 2, 1], 'some_other_id': [1, 2, 3, 3]})
    feature_stage = pipeline([one_hot_encoder('some_id'), one_hot_encoder('some_other_id')])
    estimator = assembler(feature_stage, 'assembled_column')
    feats = fit_transform(estimator, df)['assembled_column'].tolist() |> np.array
    expected_feats = np.array([[1, 0, 1, 0, 0],
                               [0, 1, 0, 1, 0],
                               [0, 1, 0, 0, 1],
                               [1, 0, 0, 0, 1]])
    assert np.allclose(feats, expected_feats), 'One-hot encoding incorrect'

